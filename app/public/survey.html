<!DOCTYPE html>
<html lang="en us">
<head>
	<meta charset="utf-8">
	<title>Friend | Finder</title>

	<!-- Latest compiled and minified CSS -->
  	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
  	<!-- JQUERY CDN -->
  	<script src="https://code.jquery.com/jquery.js"></script>

  	<!-- BOOTSTRAPING THIS BABY -->
  	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

  	<!-- Font Awesome CDN -->
  	<script src="https://use.fontawesome.com/97a3d525bd.js"></script>

	<!-- Chosen -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.5.1/chosen.css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.5.1/chosen.jquery.min.js"></script>


</head>
<body>
	<div class="container">
		<h2 class="text-left">Survey Questions</h2>
		<hr>
		<h3 class="text-left"><b>About You</b></h3>
		<h4>Name (Required)</h4>
			<div class="form-group">
				<input type="text" class="form-control" id="name">
			</div>
		<h4>Link to Photo Image (Required)</h4>
			<div class="form-group">
				<input type="text" class="form-control" id="photo">
			</div>
		<hr>
		<h3 class="text-left"><b>Question 1</b></h3>
			<h4>First of all, do you like Nutella?</h4>
			<select data-placeholder="Select An Option" class="chosen-select" id="num1" style="width:160px;">
				<option value=""></option>
				<option value="1">1 (Strongly Agree)</option>
				<option value="2">2</option>
				<option value="3">3</option>
				<option value="4">4</option>
				<option value="5">5 (Strongly Disagree)</option>
			</select>
		<h3 class="text-left"><b>Question 2</b></h3>
			<h4>How about electronic music?</h4>
			<select data-placeholder="Select An Option" class="chosen-select" id="num2" style="width:160px;">
				<option value=""></option>
				<option value="1">1 (Strongly Agree)</option>
				<option value="2">2</option>
				<option value="3">3</option>
				<option value="4">4</option>
				<option value="5">5 (Strongly Disagree)</option>
			</select>
		<h3 class="text-left"><b>Question 3</b></h3>
			<h4>Football(1) or Soccer(5)?</h4>
			<select data-placeholder="Select An Option" class="chosen-select" id="num3" style="width:160px;">
				<option value=""></option>
				<option value="1">1 (Strongly Agree)</option>
				<option value="2">2</option>
				<option value="3">3</option>
				<option value="4">4</option>
				<option value="5">5 (Strongly Disagree)</option>
			</select>
		<h3 class="text-left"><b>Question 4</b></h3>
			<h4>Now let's get to the serious stuff: Are you loyal?
			</h4>
			<select data-placeholder="Select An Option" class="chosen-select" id="num4" style="width:160px;">
				<option value=""></option>
				<option value="1">1 (Strongly Agree)</option>
				<option value="2">2</option>
				<option value="3">3</option>
				<option value="4">4</option>
				<option value="5">5 (Strongly Disagree)</option>
			</select>
		<h3 class="text-left"><b>Question 5</b></h3>
			<h4>Are you a dreamer?</h4>
			<select data-placeholder="Select An Option" class="chosen-select" id="num5" style="width:160px;">
				<option value=""></option>
				<option value="1">1 (Strongly Agree)</option>
				<option value="2">2</option>
				<option value="3">3</option>
				<option value="4">4</option>
				<option value="5">5 (Strongly Disagree)</option>
			</select>
		<h3 class="text-left"><b>Question 6</b></h3>
			<h4>... or a realist?</h4>
			<select data-placeholder="Select An Option" class="chosen-select" id="num6" style="width:160px;">
				<option value=""></option>
				<option value="1">1 (Strongly Agree)</option>
				<option value="2">2</option>
				<option value="3">3</option>
				<option value="4">4</option>
				<option value="5">5 (Strongly Disagree)</option>
			</select>
		<h3 class="text-left"><b>Question 7</b></h3>
			<h4>Superman(1) or Batman(5)?</h4>
			<select data-placeholder="Select An Option" class="chosen-select" id="num7" style="width:160px;">
				<option value=""></option>
				<option value="1">1 (Strongly Agree)</option>
				<option value="2">2</option>
				<option value="3">3</option>
				<option value="4">4</option>
				<option value="5">5 (Strongly Disagree)</option>
			</select>
		<h3 class="text-left"><b>Question 8</b></h3>
			<h4>You're a beach bum!</h4>
			<select data-placeholder="Select An Option" class="chosen-select" id="num8" style="width:160px;">
				<option value=""></option>
				<option value="1">1 (Strongly Agree)</option>
				<option value="2">2</option>
				<option value="3">3</option>
				<option value="4">4</option>
				<option value="5">5 (Strongly Disagree)</option>
			</select>
		<h3 class="text-left"><b>Question 9</b></h3>
			<h4>You enjoy working out and being active!</h4>
			<select data-placeholder="Select An Option" class="chosen-select" id="num9" style="width:160px;">
				<option value=""></option>
				<option value="1">1 (Strongly Agree)</option>
				<option value="2">2</option>
				<option value="3">3</option>
				<option value="4">4</option>
				<option value="5">5 (Strongly Disagree)</option>
			</select>
		<h3 class="text-left"><b>Question 10</b></h3>
			<h4>You're always in a good mood regardless of the circumstances!</h4>
			<select data-placeholder="Select An Option" class="chosen-select" id="num10" style="width:160px;">
				<option value=""></option>
				<option value="1">1 (Strongly Agree)</option>
				<option value="2">2</option>
				<option value="3">3</option>
				<option value="4">4</option>
				<option value="5">5 (Strongly Disagree)</option>
			</select>
		<br><br>

		<button type="submit" class="btn btn-primary btn-lg btn-block submit"><span class="glyphicon glyphicon-ok-sign" aria-hidden="true"></span></span> Submit</button>
		<hr>

		<footer class="footer">
			<div class="container">
				<p><a href="/api/friends">API Friends List | </a><a href="https://github.com/aausek/Friend-Finder.git"> GitHub Repo <i class="fa fa-github" aria-hidden="true"></i></a></p>
			</div>
		</footer>

	</div>
	<div id="show-modal" class="modal fade">
	  <div class="modal-dialog" role="document">
	    <div class="modal-content">
	      <div class="modal-header">
	        <h5 class="modal-title">Friend | Finder</h5>
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
	          <span aria-hidden="true">&times;</span>
	        </button>
	      </div>
	      <div class="modal-body">
	        <p></p>
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-primary">Save changes</button>
	        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
	      </div>
	    </div>
	  </div>
</div>

	<script type="text/javascript">
		
		// Chosen CSS
		//Setting the width of answer dropdowns
	    $(".chosen-select").chosen({width: "13%"});

	    //Once the user clicks "Submit" the selected data is registered and displayed in the modal
	    $(".submit").on("click", function(event) {
	    	event.preventDefault();

	    	function validateIt() {
	    		var valid = true;
	    		$(".form-control").each(function() {
	    			if ($(this).val() === "") {
	    				valid = false;
	    				alert("Please fill out all fields before submitting!");
	    				return false;
	    			}else {
	    				var newFriend = {
		    		name: $("#name").val(),
		    		photo: $("#photo").val(),
		    		scores: [$("select[id=num1] option:selected").val(),
		    			$("select[id=num2] option:selected").val(),
		    			$("select[id=num3] option:selected").val(),
		    			$("select[id=num4] option:selected").val(),
		    			$("select[id=num5] option:selected").val(),
		    			$("select[id=num6] option:selected").val(),
		    			$("select[id=num7] option:selected").val(),
		    			$("select[id=num8] option:selected").val(),
		    			$("select[id=num9] option:selected").val(),
		    			$("select[id=num10] option:selected").val(),
		    			]
		    	};
	    	//Logging the response for functionality check
	    	console.log(newFriend);

	    	//Add user entry to JSON object "friends"
	    	$.post("/api/friends", newFriend , function(data) {
		   		if (data) {
		   			console.log("New friend added!");
		   		}
	   		});
	    			}
	    		});
	    	}
	    	validateIt();
	    	
	    	//Assigning the selectiions to a new object "newFriend"
	    	// var newFriend = {
	    	// 	name: $("#name").val(),
	    	// 	photo: $("#photo").val(),
	    	// 	scores: [$("select[id=num1] option:selected").val(),
	    	// 		$("select[id=num2] option:selected").val(),
	    	// 		$("select[id=num3] option:selected").val(),
	    	// 		$("select[id=num4] option:selected").val(),
	    	// 		$("select[id=num5] option:selected").val(),
	    	// 		$("select[id=num6] option:selected").val(),
	    	// 		$("select[id=num7] option:selected").val(),
	    	// 		$("select[id=num8] option:selected").val(),
	    	// 		$("select[id=num9] option:selected").val(),
	    	// 		$("select[id=num10] option:selected").val(),
	    	// 		]
	    	// };
	    	// //Logging the response for functionality check
	    	// console.log(newFriend);

	    	// //Add user entry to JSON object "friends"
	    	// $.post("/api/friends", newFriend , function(data) {
		   	// 	if (data) {
		   	// 		console.log("New friend added!");
		   	// 	}
	   		// });

	   		// var newScores = newFriend.scores.map(Number);
	   		// console.log(newScores);

	   		// var totalDiff = $(newFriend.scores).not(newScores).get();
	   		// console.log(totalDiff);
	   		var totalDiff = 0,
	   			match;

	   		function calcDiff(newFriend) {
	   			var currentURL = window.location.origin;
	   			$.ajax({
	   				url: currentURL + "/api/friends",
	   				method: "GET"
	   			})
	   			.done(function(friendArray) {
	   				console.log("URL:" + currentURL + "/api/friends");
	   				console.log(friendArray);
	   				match = friendArray[0];
	   				var currentMatch = 99;
	   				for (var i = 0; i < friendArray.length; i++) {
	   					totalDiff = 0;
	   					console.log(friendArray[i].scores);
	   					for (var x = 0; x < newFriend.scores.length; x++) {
	   						var theDiff = Math.abs(friendArray[i].scores[x] - newFriend.scores[x]);
	   						totalDiff += theDiff;
	   					}
		   				if (totalDiff === currentMatch) {
		   					currentMatch = totalDiff;
		   					console.log(totalDiff);
		   					match = friendArray[i];
		   					console.log(match);
	   					}
	   				}
	   				calcDiff(newFriend);
	   				modalDisplay(match);
	   			});
	   		}
	   		//calcDiff(newFriend);

	   		function modalDisplay(match) {
	   			$(".modal-body").append("<p>Your most compatible match is: " + match.name + "</p>");
	   			$(".modal-body").append('<img src="' + match.photo + '"/>');
	   			$("#show-modal").modal("show");
	   		}
	    });

	    //Add user entry to JSON object "friends"
	</script>

</body>
</html>